// Modified internal/app/myapp.go
package app

import (
    "net/http"

    "github.com/go-chi/chi/v5"
    "go.mongodb.org/mongo-driver/mongo"

    "myapp/internal/config"
    "myapp/internal/handler"
    "myapp/internal/repository"
    "myapp/internal/service"
)

type App struct {
    cfg         *config.Config
    router      *chi.Mux
    httpServer  *http.Server
    mongoClient *mongo.Client
    handlers    *handler.Handlers
    services    *service.Services
    repos       *repository.Repositories
}

func New(cfg *config.Config) (*App, error) {
    app := &App{
        cfg:    cfg,
        router: chi.NewRouter(),
    }

    if err := app.initMongoDB(); err != nil {
        return nil, err
    }

    // Initialize repositories
    app.repos = repository.NewRepositories(app.mongoClient.Database(app.cfg.MongoDB.Database))
    
    // Initialize services
    app.services = service.NewServices(app.repos)
    
    // Initialize handlers
    app.handlers = handler.NewHandlers(app.services)

    // Setup router
    app.setupMiddleware(app.router)
    app.setupRoutes(app.router, app.handlers)
    app.initHTTPServer()

    return app, nil
}